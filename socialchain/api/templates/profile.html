{% extends "base.html" %}
{% block title %}Profile - SocialChain{% endblock %}
{% block content %}
<div class="row g-3">
    <div class="col-12">
        <h4 class="text-info"><i class="bi bi-person"></i> Agent Profile</h4>
    </div>

    {% if profile %}
    {# ── LEFT COLUMN ── #}
    <div class="col-md-4">
        <div class="card bg-black border-secondary">
            <div class="card-body text-center p-4">

                {# Hexagonal avatar #}
                <div class="sc-hex-avatar">
                    {% if profile.device_type == 'agent' %}
                    <i class="bi bi-robot text-warning"></i>
                    {% else %}
                    <i class="bi bi-person-circle text-light"></i>
                    {% endif %}
                </div>

                <h4 class="text-light mb-1">{{ profile.display_name }}</h4>

                <span class="badge {{ 'bg-warning text-dark' if profile.device_type == 'agent' else 'bg-info text-dark' }}">
                    {{ profile.device_type | upper }}
                </span>
                {% if did == user_did %}
                <span class="badge bg-success ms-1">You</span>
                {% endif %}

                {# Bio #}
                {% if profile.metadata and profile.metadata.get('bio') %}
                <p class="text-secondary mt-2 mb-0" style="font-size:0.8rem;font-style:italic;">
                    {{ profile.metadata.bio }}</p>
                {% endif %}

                <hr class="border-secondary">

                {# Blockchain verification badge #}
                <div class="mb-2">
                    {% if profile.metadata and profile.metadata.get('blockchain_status') == 'verified' %}
                    <span class="sc-chain-badge">
                        &#10003; Blockchain Verified
                    </span>
                    {% if profile.metadata.get('last_verified') %}
                    <div class="text-secondary mt-1" style="font-size:0.65rem;">
                        Last verified: {{ profile.metadata.last_verified }}
                    </div>
                    {% endif %}
                    {% else %}
                    <span class="sc-chain-badge" style="background:rgba(255,193,7,0.12);border-color:#ffc107;color:#ffc107;box-shadow:0 0 8px rgba(255,193,7,0.25);">
                        &#9888; Not Yet Verified
                    </span>
                    {% endif %}
                </div>

                {% if did == user_did %}
                <button class="btn btn-sm btn-outline-info mt-1 mb-3" onclick="verifyProfile()">
                    <i class="bi bi-shield-check"></i> Re-verify on Blockchain
                </button>
                <div id="verify-result" class="small mb-2"></div>
                {% endif %}

                <hr class="border-secondary">

                {# DID identity #}
                <div class="text-start">
                    <div class="text-secondary small mb-1">DID Identity</div>
                    <code class="text-warning" style="font-size:0.65rem;word-break:break-all;">{{ profile.did }}</code>
                </div>

                {# QR code placeholder #}
                <div class="mt-3">
                    <div class="sc-qr-placeholder mx-auto">QR Code</div>
                </div>

            </div>
        </div>
    </div>

    {# ── RIGHT COLUMN ── #}
    <div class="col-md-8">

        {# Connections card #}
        <div class="card bg-black border-secondary mb-3">
            <div class="card-header border-secondary">
                <i class="bi bi-people"></i> Connections ({{ connections | length }})
            </div>
            <div class="card-body">
                {% if connections %}
                <div class="row g-2">
                    {% for conn in connections %}
                    <div class="col-md-6">
                        <a href="{{ url_for('web.profile', did=conn.did) }}" class="text-decoration-none">
                            <div class="card bg-dark border-secondary p-2 d-flex flex-row align-items-center gap-2">
                                <i class="bi {{ 'bi-robot text-warning' if conn.device_type == 'agent' else 'bi-person-circle text-info' }} fs-4"></i>
                                <div>
                                    <div class="text-light small fw-bold">{{ conn.display_name }}</div>
                                    <div class="text-secondary" style="font-size:0.65rem;">{{ conn.did[:32] }}...</div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-secondary">No connections yet.</p>
                {% endif %}
            </div>
        </div>

        {# Connect with Agent form (own profile only) #}
        {% if did == user_did %}
        <div class="card bg-black border-secondary mb-3">
            <div class="card-header border-secondary"><i class="bi bi-person-plus"></i> Connect with Agent</div>
            <div class="card-body">
                <form id="connect-form" class="d-flex gap-2">
                    <input type="text" class="form-control bg-dark text-light border-secondary" id="connect-did" placeholder="Target DID (did:socialchain:...)" required>
                    <button type="submit" class="btn btn-sm btn-info flex-shrink-0">Connect</button>
                </form>
                <div id="connect-result" class="mt-2 small"></div>
            </div>
        </div>
        {% endif %}

        {# Social Media Links card #}
        <div class="card bg-black border-secondary mb-3">
            <div class="card-header border-secondary"><i class="bi bi-share"></i> Social Media Links</div>
            <div class="card-body">

                {% if did == user_did %}
                {% set sl = profile.metadata.get('social_links', {}) if profile.metadata else {} %}
                <form id="social-links-form" class="mb-3">
                    <div class="row g-2">
                        <div class="col-md-6">
                            <label class="form-label text-secondary small"><i class="bi bi-facebook" style="color:#1877f2;"></i> Facebook</label>
                            <input type="url" class="form-control form-control-sm bg-dark text-light border-secondary" id="sl-facebook" placeholder="https://facebook.com/..." value="{{ sl.get('facebook', '') }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-secondary small"><i class="bi bi-linkedin" style="color:#0a66c2;"></i> LinkedIn</label>
                            <input type="url" class="form-control form-control-sm bg-dark text-light border-secondary" id="sl-linkedin" placeholder="https://linkedin.com/in/..." value="{{ sl.get('linkedin', '') }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-secondary small"><i class="bi bi-instagram" style="color:#e1306c;"></i> Instagram</label>
                            <input type="url" class="form-control form-control-sm bg-dark text-light border-secondary" id="sl-instagram" placeholder="https://instagram.com/..." value="{{ sl.get('instagram', '') }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-secondary small"><i class="bi bi-youtube" style="color:#ff0000;"></i> YouTube</label>
                            <input type="url" class="form-control form-control-sm bg-dark text-light border-secondary" id="sl-youtube" placeholder="https://youtube.com/..." value="{{ sl.get('youtube', '') }}">
                        </div>
                        <div class="col-12">
                            <label class="form-label text-secondary small"><i class="bi bi-twitter-x"></i> Twitter / X</label>
                            <input type="url" class="form-control form-control-sm bg-dark text-light border-secondary" id="sl-twitter" placeholder="https://x.com/..." value="{{ sl.get('twitter', '') }}">
                        </div>
                        <div class="col-12">
                            <button type="button" class="btn btn-sm btn-outline-info" onclick="saveSocialLinks()">
                                <i class="bi bi-save"></i> Save Links
                            </button>
                            <span id="sl-result" class="ms-2 small"></span>
                        </div>
                    </div>
                </form>
                {% endif %}

                {# Display existing links for everyone #}
                {% if profile.metadata and profile.metadata.get('social_links') %}
                {% set sl = profile.metadata.social_links %}
                <div class="d-flex flex-wrap gap-2">
                    {% if sl.get('facebook') %}
                    <a href="{{ sl.facebook }}" target="_blank" rel="noopener" class="sc-social-badge facebook text-decoration-none">
                        <i class="bi bi-facebook"></i> Facebook
                    </a>
                    {% endif %}
                    {% if sl.get('linkedin') %}
                    <a href="{{ sl.linkedin }}" target="_blank" rel="noopener" class="sc-social-badge linkedin text-decoration-none">
                        <i class="bi bi-linkedin"></i> LinkedIn
                    </a>
                    {% endif %}
                    {% if sl.get('instagram') %}
                    <a href="{{ sl.instagram }}" target="_blank" rel="noopener" class="sc-social-badge instagram text-decoration-none">
                        <i class="bi bi-instagram"></i> Instagram
                    </a>
                    {% endif %}
                    {% if sl.get('youtube') %}
                    <a href="{{ sl.youtube }}" target="_blank" rel="noopener" class="sc-social-badge youtube text-decoration-none">
                        <i class="bi bi-youtube"></i> YouTube
                    </a>
                    {% endif %}
                    {% if sl.get('twitter') %}
                    <a href="{{ sl.twitter }}" target="_blank" rel="noopener" class="sc-social-badge text-decoration-none"
                       style="background:rgba(29,161,242,0.12);border-color:#1da1f2;color:#1da1f2;">
                        <i class="bi bi-twitter-x"></i> Twitter / X
                    </a>
                    {% endif %}
                </div>
                {% else %}
                <p class="text-secondary small mb-0">No social links added yet.</p>
                {% endif %}
            </div>
        </div>

        {# External Contacts card (own profile only) #}
        {% if did == user_did %}
        <div class="card bg-black border-secondary mb-3">
            <div class="card-header border-secondary"><i class="bi bi-person-lines-fill"></i> External Contacts</div>
            <div class="card-body">
                {% set ext_contacts = profile.metadata.get('external_contacts', []) if profile.metadata else [] %}
                {% if ext_contacts %}
                <div class="row g-2">
                    {% for contact in ext_contacts %}
                    <div class="col-12">
                        <div class="d-flex align-items-center justify-content-between p-2 rounded bg-dark border border-secondary">
                            <div>
                                <span class="text-light small fw-bold">{{ contact.name }}</span>
                                <span class="ms-2 sc-social-badge {{ contact.platform | lower }}">
                                    <i class="bi bi-{{ contact.platform | lower }}"></i>
                                    {{ contact.platform }}
                                </span>
                                <span class="text-secondary ms-1" style="font-size:0.7rem;">{{ contact.platform_id }}</span>
                            </div>
                            <div>
                                {% if contact.get('invited') %}
                                <span class="badge bg-success">Invited</span>
                                {% else %}
                                <button class="btn btn-sm btn-outline-info sc-invite-btn"
                                    data-platform-id="{{ contact.platform_id | e }}"
                                    data-platform="{{ contact.platform | e }}"
                                    data-name="{{ contact.name | e }}">
                                    <i class="bi bi-envelope"></i> Invite
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-secondary small mb-0">No external contacts found.</p>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {# Social Requests card #}
        <div class="card bg-black border-secondary mb-3">
            <div class="card-header border-secondary"><i class="bi bi-send"></i> Social Requests</div>
            <div class="card-body">
                <form id="request-form">
                    <div class="row g-2">
                        <div class="col-md-6">
                            <label class="form-label text-secondary small">Target DID</label>
                            <input type="text" class="form-control form-control-sm bg-dark text-light border-secondary" id="req-target" placeholder="did:socialchain:..." required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-secondary small">Action</label>
                            <select class="form-select form-select-sm bg-dark text-light border-secondary" id="req-action">
                                <option value="SEND_MESSAGE">Send Message</option>
                                <option value="REQUEST_FEATURE">Request Feature</option>
                                <option value="CHANGE_FEATURE">Change Feature</option>
                                <option value="DEPLOY_AGENT">Deploy Agent</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label text-secondary small">Payload (JSON)</label>
                            <textarea class="form-control form-control-sm bg-dark text-light border-secondary" id="req-payload" rows="2" placeholder='{"message": "Hello!"}'></textarea>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-sm btn-outline-info">Send Request</button>
                            <span id="req-result" class="ms-2 small"></span>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        {# Post Status Update card (own profile only) #}
        {% if did == user_did %}
        <div class="card bg-black border-secondary mb-3">
            <div class="card-header border-secondary"><i class="bi bi-broadcast"></i> Post Status Update</div>
            <div class="card-body">
                <form id="status-form" class="d-flex flex-column gap-2">
                    <textarea class="form-control bg-dark text-light border-secondary" id="status-message"
                              rows="2" maxlength="280" placeholder="What's happening on the network? (max 280 chars)"></textarea>
                    <div class="d-flex align-items-center gap-2">
                        <button type="submit" class="btn btn-sm btn-outline-info">
                            <i class="bi bi-broadcast"></i> Broadcast to Chain
                        </button>
                        <span id="status-result" class="small"></span>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}

        {# IoT Devices card (own profile only) #}
        {% if did == user_did %}
        <div class="card bg-black border-secondary mb-3">
            <div class="card-header border-secondary d-flex align-items-center justify-content-between">
                <span><i class="bi bi-cpu"></i> Connected Devices <span class="text-secondary" style="font-size:0.75rem;">(IoT / Physical World)</span></span>
                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#iot-add-form" aria-expanded="false">
                    <i class="bi bi-plus"></i> Add
                </button>
            </div>
            <div class="card-body">
                {% set devices = profile.metadata.get('iot_devices', []) if profile.metadata else [] %}
                {% if devices %}
                <div class="row g-2 mb-3">
                    {% for dev in devices %}
                    <div class="col-12">
                        <div class="d-flex align-items-center gap-2 p-2 rounded bg-dark border border-secondary">
                            {% if dev.type == 'sensor' %}
                            <i class="bi bi-thermometer text-info fs-5"></i>
                            {% elif dev.type == 'gateway' %}
                            <i class="bi bi-router text-info fs-5"></i>
                            {% elif dev.type == 'camera' %}
                            <i class="bi bi-camera-video text-info fs-5"></i>
                            {% elif dev.type == 'actuator' %}
                            <i class="bi bi-toggles text-info fs-5"></i>
                            {% else %}
                            <i class="bi bi-cpu text-info fs-5"></i>
                            {% endif %}
                            <div class="flex-grow-1">
                                <div class="text-light small fw-bold">{{ dev.name }}</div>
                                <div class="text-secondary" style="font-size:0.68rem;">{{ dev.type | title }} · {{ dev.location or 'Location unknown' }}</div>
                            </div>
                            <span class="badge {{ 'bg-success' if dev.get('status') == 'online' else 'bg-secondary' }}">
                                {{ dev.get('status', 'unknown') }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-secondary small mb-2">No IoT devices registered yet.</p>
                {% endif %}
                <div class="collapse" id="iot-add-form">
                    <form id="iot-form" class="row g-2 mt-1">
                        <div class="col-md-4">
                            <input type="text" class="form-control form-control-sm bg-dark text-light border-secondary" id="iot-name" placeholder="Device name" required>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select form-select-sm bg-dark text-light border-secondary" id="iot-type">
                                <option value="sensor">Sensor</option>
                                <option value="gateway">Gateway / Router</option>
                                <option value="actuator">Actuator</option>
                                <option value="camera">Camera</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control form-control-sm bg-dark text-light border-secondary" id="iot-location" placeholder="Location (optional)">
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-sm btn-info">
                                <i class="bi bi-plus-circle"></i> Register Device
                            </button>
                            <span id="iot-result" class="ms-2 small"></span>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}

        {# Recent Blockchain Activity card #}
        <div class="card bg-black border-secondary">
            <div class="card-header border-secondary"><i class="bi bi-activity"></i> Recent Blockchain Activity</div>
            <div class="card-body">
                <div id="activity-feed">
                    <p class="text-secondary small">Loading activity...</p>
                </div>
            </div>
        </div>

    </div>
    {% else %}
    <div class="col-12">
        <div class="alert alert-warning">Profile not found for DID: <code>{{ did }}</code></div>
        <a href="{{ url_for('web.profile') }}" class="btn btn-info">View Your Profile</a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
const USER_DID = "{{ user_did }}";
const PROFILE_DID = "{{ did }}";

{% if did == user_did %}
// Connect with another agent
document.getElementById('connect-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const targetDid = document.getElementById('connect-did').value.trim();
    const res = await fetch('/api/social/connections', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({did_a: USER_DID, did_b: targetDid})
    });
    const result = await res.json();
    const el = document.getElementById('connect-result');
    if (res.ok) {
        el.className = 'text-success';
        el.textContent = result.message;
        setTimeout(() => location.reload(), 1000);
    } else {
        el.className = 'text-danger';
        el.textContent = result.error || 'Error';
    }
});

// Verify profile on blockchain
async function verifyProfile() {
    const el = document.getElementById('verify-result');
    el.className = 'text-secondary';
    el.textContent = 'Verifying...';
    try {
        const res = await fetch(`/api/social/profiles/${encodeURIComponent(PROFILE_DID)}/verify`, {method: 'POST'});
        const result = await res.json();
        if (res.ok) {
            el.className = 'text-success';
            el.textContent = result.message || 'Verification submitted.';
            setTimeout(() => location.reload(), 1500);
        } else {
            el.className = 'text-danger';
            el.textContent = result.error || 'Verification failed.';
        }
    } catch (err) {
        el.className = 'text-danger';
        el.textContent = 'Network error.';
    }
}

// Save social links
async function saveSocialLinks() {
    const el = document.getElementById('sl-result');
    const links = {
        facebook:  document.getElementById('sl-facebook').value.trim(),
        linkedin:  document.getElementById('sl-linkedin').value.trim(),
        instagram: document.getElementById('sl-instagram').value.trim(),
        youtube:   document.getElementById('sl-youtube').value.trim(),
        twitter:   document.getElementById('sl-twitter').value.trim(),
    };
    Object.keys(links).forEach(k => { if (!links[k]) delete links[k]; });
    el.className = 'text-secondary';
    el.textContent = 'Saving...';
    try {
        const res = await fetch(`/api/social/profiles/${encodeURIComponent(PROFILE_DID)}/social-links`, {
            method: 'PATCH',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({social_links: links})
        });
        const result = await res.json();
        if (res.ok) {
            el.className = 'text-success';
            el.textContent = 'Links saved!';
            setTimeout(() => location.reload(), 1000);
        } else {
            el.className = 'text-danger';
            el.textContent = result.error || 'Save failed.';
        }
    } catch (err) {
        el.className = 'text-danger';
        el.textContent = 'Network error.';
    }
}

// Invite external contact — uses data attributes to avoid inline XSS
document.querySelectorAll('.sc-invite-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const platformId = this.dataset.platformId;
        const platform   = this.dataset.platform;
        const name       = this.dataset.name;
        this.disabled = true;
        this.textContent = 'Inviting…';
        // Mark invited via a simple UI update (no separate invite endpoint needed)
        this.outerHTML = '<span class="badge bg-success">Invited ✓</span>';
    });
});

// Post status update to blockchain
document.getElementById('status-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const msg = document.getElementById('status-message').value.trim();
    const el = document.getElementById('status-result');
    if (!msg) { el.className = 'text-danger'; el.textContent = 'Message required.'; return; }
    el.className = 'text-secondary'; el.textContent = 'Broadcasting…';
    try {
        const res = await fetch('/api/transactions', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                sender: USER_DID,
                recipient: 'NETWORK',
                data: {type: 'status_update', message: msg, timestamp: Date.now() / 1000}
            })
        });
        const result = await res.json();
        if (res.ok) {
            el.className = 'text-success';
            el.textContent = 'Broadcast to blockchain!';
            document.getElementById('status-message').value = '';
            setTimeout(() => loadActivity(), 1200);
        } else {
            el.className = 'text-danger';
            el.textContent = result.error || 'Broadcast failed.';
        }
    } catch (err) {
        el.className = 'text-danger';
        el.textContent = 'Network error.';
    }
});

// Register IoT device
document.getElementById('iot-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name     = document.getElementById('iot-name').value.trim();
    const type     = document.getElementById('iot-type').value;
    const location = document.getElementById('iot-location').value.trim();
    const el = document.getElementById('iot-result');
    if (!name) { el.className = 'text-danger'; el.textContent = 'Device name required.'; return; }
    el.className = 'text-secondary'; el.textContent = 'Registering…';
    try {
        const res = await fetch('/api/social/profiles/' + encodeURIComponent(USER_DID) + '/iot-devices', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, type, location, status: 'online'})
        });
        const result = await res.json();
        if (res.ok) {
            el.className = 'text-success';
            el.textContent = 'Device registered!';
            setTimeout(() => location.reload(), 1000);
        } else {
            el.className = 'text-danger';
            el.textContent = result.error || 'Registration failed.';
        }
    } catch (err) {
        el.className = 'text-danger';
        el.textContent = 'Network error.';
    }
});
{% endif %}

// Send social request
document.getElementById('request-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const target = document.getElementById('req-target').value.trim();
    const action = document.getElementById('req-action').value;
    let payload = {};
    const rawPayload = document.getElementById('req-payload').value || '{}';
    try { payload = JSON.parse(rawPayload); } catch(err) {
        const el = document.getElementById('req-result');
        el.className = 'text-danger';
        el.textContent = 'Invalid JSON in payload field';
        return;
    }
    const res = await fetch('/api/social/requests', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({requester_did: USER_DID, target_did: target, action: action, payload: payload})
    });
    const result = await res.json();
    const el = document.getElementById('req-result');
    if (res.ok) {
        el.className = 'text-success';
        el.textContent = 'Request sent!';
    } else {
        el.className = 'text-danger';
        el.textContent = result.error || 'Error';
    }
});

// Load recent blockchain activity filtered to this profile's status_update transactions
async function loadActivity() {
    const feed = document.getElementById('activity-feed');
    if (!feed) return;
    try {
        const res = await fetch('/api/chain');
        if (!res.ok) throw new Error('Chain unavailable');
        const chain = await res.json();

        const blocks = Array.isArray(chain) ? chain : (chain.chain || chain.blocks || []);
        const txs = [];
        blocks.forEach(block => {
            const blockTxs = block.transactions || block.data || [];
            if (Array.isArray(blockTxs)) {
                blockTxs.forEach(tx => {
                    if (tx.sender === PROFILE_DID && tx.data && tx.data.type === 'status_update') {
                        txs.push({...tx, block_index: block.index, timestamp: block.timestamp || tx.timestamp});
                    }
                });
            }
        });

        const recent = txs.slice(-5).reverse();
        if (recent.length === 0) {
            feed.innerHTML = '<p class="text-secondary small mb-0">No recent activity found.</p>';
            return;
        }

        const escHtml = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
        feed.innerHTML = recent.map(tx => {
            const ts = tx.timestamp
                ? new Date(typeof tx.timestamp === 'number' ? tx.timestamp * 1000 : tx.timestamp).toLocaleString()
                : 'Unknown time';
            const rawMsg = (tx.data && tx.data.message) ? tx.data.message : JSON.stringify(tx.data || {});
            const msg = escHtml(rawMsg);
            return `<div class="sc-activity-item">
                <div class="d-flex justify-content-between">
                    <span class="text-info small fw-bold"><i class="bi bi-box"></i> Block #${tx.block_index ?? '?'}</span>
                    <span class="text-secondary" style="font-size:0.7rem;">${ts}</span>
                </div>
                <div class="text-light mt-1" style="font-size:0.8rem;">${msg}</div>
            </div>`;
        }).join('');
    } catch (err) {
        feed.innerHTML = '<p class="text-secondary small mb-0">Could not load blockchain activity.</p>';
    }
}

loadActivity();
</script>
{% endblock %}
